import{d,y as p}from"./hooks.module.Bla9ZUYE.js";import{u as a}from"./jsxRuntime.module.BSCWCfwz.js";import"./preact.module.IsPPbktY.js";const o=[{id:"interest",label:"How interesting was this story?"},{id:"clarity",label:"How clear was the explanation?"},{id:"vocabulary",label:"How useful were the new words?"},{id:"culture",label:"Was the culture part interesting?"},{id:"recommend",label:"Would you recommend this lesson?"}],v=[{value:1,emoji:"ðŸ˜•",title:"1 - Not at all"},{value:2,emoji:"ðŸ˜",title:"2 - A little"},{value:3,emoji:"ðŸ™‚",title:"3 - Okay"},{value:4,emoji:"ðŸ˜Š",title:"4 - Good"},{value:5,emoji:"ðŸ”¥",title:"5 - Excellent"}],h="episode-rating-",k="feedback-";function b(r){const n=o.map(s=>Number(r[s.id])).filter(s=>Number.isFinite(s)&&s>=1&&s<=5);if(n.length===0)return 0;const i=n.reduce((s,c)=>s+c,0);return Number((i/n.length).toFixed(2))}function j({episodeId:r=""}){const[n,i]=d({}),[s,c]=d(!1),[m,u]=d(0);p(()=>{if(r)try{const t=localStorage.getItem(`${h}${r}`);if(!t)return;const e=JSON.parse(t),l=e?.responses&&typeof e.responses=="object"?e.responses:{};Object.keys(l).length===o.length&&(i(l),u(Number(e.average||b(l))),c(!0))}catch{}},[r]);const g=t=>{const e=b(t),l={responses:t,average:e,count:o.length,ratedAt:Date.now(),version:1};i(t),u(e),c(!0);try{localStorage.setItem(`${h}${r}`,JSON.stringify(l)),localStorage.setItem(`${k}${r}`,JSON.stringify({...t,timestamp:l.ratedAt}))}catch{}window.dispatchEvent(new CustomEvent("episode-rating-updated",{detail:{episodeId:r,average:e}}))},f=(t,e)=>{if(s)return;const l={...n,[t]:e};i(l),Object.keys(l).length===o.length&&g(l)};return s?a("div",{class:"card feedback-widget",children:[a("h2",{children:"Thanks for rating this lesson"}),a("p",{class:"feedback-score",children:["Popular score saved: ",m.toFixed(2),"/5"]}),a("p",{class:"muted",children:"This score is used by the Popular sort on the homepage."}),a("button",{class:"button button-secondary feedback-edit-btn",type:"button",onClick:()=>c(!1),children:"Update rating"})]}):a("div",{class:"card feedback-widget",children:[a("h2",{children:"Rate this lesson"}),a("p",{class:"muted",children:"Answer 5 quick questions. It helps rank better lessons."}),o.map(t=>a("div",{class:"feedback-row",children:[a("span",{class:"feedback-label",children:t.label}),a("div",{class:"feedback-options",children:v.map(e=>a("button",{type:"button",class:`feedback-emoji ${Number(n[t.id])===e.value?"selected":""}`,onClick:()=>f(t.id,e.value),title:e.title,"aria-label":`${t.label}: ${e.title}`,children:[a("span",{children:e.emoji}),a("small",{children:e.value})]},e.value))})]},t.id))]})}export{j as default};
