import{d as h,y as u}from"./hooks.module.Bla9ZUYE.js";import{g as k,d as A,a as F,b as I,i as C,c as P,r as H,l as U}from"./deckStore.D53geRse.js";import{u as e}from"./jsxRuntime.module.BSCWCfwz.js";import{k as Y}from"./preact.module.IsPPbktY.js";import"./signals.module.5DjgXsWM.js";function _(a){return String(a||"").replace(/\s+/g," ").trim()}function j(a,s=78){const r=_(a);return r?r.length<=s?r:`${r.slice(0,s-1).trim()}...`:""}function K(a){if(!a)return"n/a";const s=new Date(a);return Number.isNaN(s.getTime())?"n/a":s.toLocaleDateString()}function O(a){return a==="due"?"Due":a==="mastered"?"Mastered":"Learning"}function T({open:a=!1,onClose:s}){const[r,f]=h(""),[l,x]=h("all"),[d,g]=h("last_seen"),[p,v]=h("");u(()=>{if(!a)return;const t=b=>{b.key==="Escape"&&s?.()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[a,s]),u(()=>{a||v("")},[a]);const w=k({filter:l,search:r,sort:d}),i=k({filter:"all",search:"",sort:"last_seen"}).length>0;return a?e("section",{class:"learned-drawer",role:"complementary","aria-label":"All learned words",children:[e("div",{class:"learned-drawer-header",children:[e("h3",{children:"All Learned Words"}),e("button",{type:"button",class:"button button-secondary learned-drawer-close",onClick:()=>s?.(),children:"Close"})]}),e("div",{class:"learned-drawer-controls",children:[e("input",{class:"learned-search",type:"search",value:r,onInput:t=>f(t.currentTarget.value),placeholder:"Search words...","aria-label":"Search learned words"}),e("select",{class:"learned-sort",value:d,onChange:t=>g(t.currentTarget.value),"aria-label":"Sort learned words",children:[e("option",{value:"last_seen",children:"Last seen"}),e("option",{value:"alphabetical",children:"Alphabetical"}),e("option",{value:"due_soon",children:"Due soon"})]})]}),e("div",{class:"learned-filter-row",role:"tablist","aria-label":"Filter learned words",children:["all","due","learning","mastered","recent"].map(t=>e("button",{type:"button",class:`learned-filter-chip ${l===t?"is-active":""}`,onClick:()=>x(t),"aria-selected":l===t?"true":"false",children:t==="all"?"All":t.charAt(0).toUpperCase()+t.slice(1)},t))}),e("div",{class:"learned-drawer-list",children:i?w.length===0?e("p",{class:"learned-empty",children:"No results for this search/filter."}):w.map(t=>{const b=p===t.word;return e("article",{class:"learned-row-wrap",children:[e("button",{type:"button",class:"learned-row",onClick:()=>v(S=>S===t.word?"":t.word),children:[e("span",{class:"learned-row-main",children:[e("strong",{children:t.word}),e("span",{class:"muted",children:j(t.simpleMeaning,84)})]}),e("span",{class:`learned-status is-${t.status}`,children:O(t.status)})]}),b?e("div",{class:"learned-row-details",children:[e("p",{children:[e("strong",{children:"Meaning:"})," ",t.simpleMeaning||"Meaning not saved"]}),t.sourceSentence||t.sentence?e("p",{children:[e("strong",{children:"Context:"})," ",t.sourceSentence||t.sentence]}):null,t.example?e("p",{children:[e("strong",{children:"Example:"})," ",t.example]}):null,e("p",{class:"muted",children:["Last seen: ",K(t.lastSeenAt)," | Episodes: ",t.episodeCount||0]})]}):null]},t.word)}):e("p",{class:"learned-empty",children:"No words saved yet. Add words from the transcript first."})})]}):null}function B(a,s){if(!window.speechSynthesis||!a)return;window.speechSynthesis.cancel();const r=new SpeechSynthesisUtterance(a);r.rate=.85,r.lang="en-US",s&&(r.onend=s,r.onerror=s),window.speechSynthesis.speak(r)}function V(a,s=74){const r=String(a||"").replace(/\s+/g," ").trim();return r?r.length<=s?r:`${r.slice(0,s-1).trim()}...`:""}function G(a){return a==="due"?"Due":a==="mastered"?"Mastered":"Learning"}function ee({episodeId:a=""}){const[s,r]=h(0),[f,l]=h(!1),[x,d]=h(!1),[g,p]=h(!1),[v,w]=h(!1);u(()=>{a&&U(a)},[a]);const i=A.value,t=F(),b=I(5),S=k({filter:"due"}).length,$=k({filter:"learning"}).length,m=i.filter(n=>C(n)).length;u(()=>{s>=i.length&&i.length>0&&(r(i.length-1),l(!1))},[i.length,s]),u(()=>{const n=c=>{c.key==="ArrowLeft"&&(r(y=>Math.max(0,y-1)),l(!1)),c.key==="ArrowRight"&&(r(y=>Math.min(i.length-1,y+1)),l(!1))};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[i.length]),u(()=>()=>window.speechSynthesis?.cancel(),[]),u(()=>{g&&m===0&&(p(!1),l(!1))},[g,m]);const L=(n,c)=>{c&&c.stopPropagation(),d(!0),B(n,()=>d(!1))},D=e("section",{class:"learned-snapshot",children:[e("div",{class:"learned-snapshot-header",children:[e("h3",{children:"Your Learned Words"}),e("button",{class:"button button-primary learned-view-all-btn",type:"button",onClick:()=>w(!0),children:"View All Words"})]}),e("p",{class:"learned-stats-line",children:["Total: ",t.total," | Due: ",S," | Learning: ",$," | Mastered: ",t.mastered]}),b.length>0?e("div",{class:"learned-preview-list",children:b.map(n=>e("div",{class:"learned-preview-item",children:[e("div",{class:"learned-preview-main",children:[e("strong",{children:n.word}),e("span",{class:"muted",children:V(n.simpleMeaning,80)})]}),e("span",{class:`learned-status is-${n.status}`,children:G(n.status)})]},n.word))}):e("p",{class:"learned-empty",children:"No saved words yet. Tap words in the transcript to build your list."})]});if(i.length===0)return e("div",{class:"card",children:[e("h2",{children:"Your Flashcards"}),e("p",{class:"flashcard-empty",children:["Tap any word in the transcript above to add it to your flashcard deck.",e("br",{}),e("span",{style:{fontSize:"13px"},children:"You can save up to 20 cards."})]}),D,e(T,{open:v,onClose:()=>w(!1)})]});const o=i[s],R=()=>{const n=i.findIndex(c=>C(c));if(n===-1){p(!1);return}p(!0),r(n),l(!1),window.speechSynthesis?.cancel(),d(!1)},W=()=>{r(n=>Math.max(0,n-1)),l(!1),window.speechSynthesis?.cancel(),d(!1)},N=()=>{r(n=>Math.min(i.length-1,n+1)),l(!1),window.speechSynthesis?.cancel(),d(!1)},z=n=>{n.stopPropagation(),window.speechSynthesis?.cancel(),d(!1),H(o.word)};return e("div",{class:"card flashcard-deck",children:[e("h2",{children:"Your Flashcards"}),e("p",{class:"flashcard-counter",children:[s+1," of ",i.length,e("span",{style:{color:"var(--text-light)",marginLeft:"8px",fontSize:"13px"},children:["(",i.length,"/20 cards)"]})]}),m>0?e("div",{style:{background:"rgba(37,99,235,0.08)",borderRadius:"6px",padding:"8px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e("span",{style:{fontSize:"14px",color:"var(--primary-blue)"},children:[m," card",m!==1?"s":""," due for review"]}),e("button",{class:"button button-primary",type:"button",style:{padding:"4px 12px",minHeight:"32px",fontSize:"13px"},onClick:R,children:"Review Now"})]}):null,g?e("div",{style:{background:"rgba(15,23,42,0.05)",border:"1px dashed var(--border-light)",borderRadius:"6px",padding:"8px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",gap:"8px"},children:[e("span",{style:{fontSize:"13px",color:"var(--text-light)"},children:"Review mode active. Flip the card, then choose Again, Hard, Good, or Easy."}),e("button",{class:"button button-secondary",type:"button",style:{padding:"4px 10px",minHeight:"32px",fontSize:"13px"},onClick:()=>{p(!1),l(!1)},children:"Exit"})]}):null,e("div",{class:"flashcard-frame",children:e("div",{class:`flashcard ${f?"is-flipped":""}`,role:"button",tabIndex:0,onClick:n=>{n.target.closest(".voice-btn")||l(c=>!c)},onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),l(c=>!c))},"aria-label":"Flip flashcard",children:[e("div",{class:"flashcard-face flashcard-front",children:[e("span",{class:"flashcard-word",children:o.word}),o.phonetic?e("span",{class:"flashcard-phonetic",children:o.phonetic}):null,e("button",{class:`voice-btn ${x&&!f?"is-speaking":""}`,type:"button",onClick:n=>L(o.word,n),"aria-label":`Listen to ${o.word}`,title:"Listen",children:"ðŸ”Š"}),e("span",{class:"muted",style:{marginTop:"8px"},children:"Tap to flip"})]}),e("div",{class:"flashcard-face flashcard-back",children:[o.sentence?e("div",{class:"flashcard-context-box",children:[e("span",{class:"flashcard-context-label",children:"Context from episode"}),e("span",{class:"flashcard-example",children:['"',o.sentence,'"']})]}):null,o.definition?e("span",{class:"flashcard-definition",children:["Meaning: ",o.definition]}):e("span",{class:"flashcard-definition muted",children:"No definition available"}),e("button",{class:`voice-btn ${x&&f?"is-speaking":""}`,type:"button",onClick:n=>L(o.sentence||o.word,n),"aria-label":"Listen to sentence",title:"Listen to sentence",style:{marginTop:"8px"},children:"ðŸ”Š"}),e("span",{class:"muted",style:{marginTop:"4px"},children:"Tap to flip"})]})]})}),e("div",{class:"flashcard-nav",children:g?f?e("div",{style:{display:"flex",gap:"6px",justifyContent:"center",flexWrap:"wrap"},children:["again","hard","good","easy"].map(n=>e("button",{class:"button button-secondary",type:"button",style:{padding:"6px 14px",minHeight:"36px",fontSize:"14px",borderColor:n==="again"?"var(--error-red)":n==="easy"?"var(--success-green)":"var(--border-light)",color:n==="again"?"var(--error-red)":n==="easy"?"var(--success-green)":"var(--text-dark)"},onClick:c=>{c.stopPropagation(),P(o.word,n);const M=A.value.findIndex(E=>C(E));M!==-1?(r(M),l(!1)):(p(!1),l(!1))},children:n.charAt(0).toUpperCase()+n.slice(1)},n))}):e("div",{style:{width:"100%",textAlign:"center",fontSize:"13px",color:"var(--text-light)"},children:"Tap the card to flip and grade this review."}):e(Y,{children:[e("button",{class:"button button-secondary",type:"button",onClick:W,disabled:s===0,children:"Prev"}),e("button",{class:"flashcard-remove-btn",type:"button",onClick:z,"aria-label":`Remove ${o.word} from deck`,children:"Remove"}),e("button",{class:"button button-secondary",type:"button",onClick:N,disabled:s===i.length-1,children:"Next"})]})}),D,e(T,{open:v,onClose:()=>w(!1)})]})}export{ee as default};
